<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roshni Insights - Explore Tech Trends</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3135/3135715.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Include Marked.js for live markdown preview -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, deleteDoc, onSnapshot, collection, query, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        window.firebase = {
            initializeApp,
            getAuth,
            signInWithEmailAndPassword,
            onAuthStateChanged,
            signOut,
            signInAnonymously,
            getFirestore,
            doc,
            getDoc,
            addDoc,
            setDoc,
            deleteDoc,
            onSnapshot,
            collection,
            query,
            setLogLevel
        };
        setLogLevel('Debug');
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            color: #cbd5e0;
        }

        .gradient-text {
            background-image: linear-gradient(to right, #66d9ef, #a6e22e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent;
        }

        .neumorphic-card {
            background-color: #1a202c;
            box-shadow: 8px 8px 16px #121820, -8px -8px 16px #22283a;
            transition: all 0.3s ease;
        }

        .neumorphic-card:hover {
            transform: translateY(-5px);
            box-shadow: 12px 12px 24px #121820, -12px -12px 24px #22283a;
        }

        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .btn-primary {
            background-color: #a6e22e;
            color: #1a202c;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #92cd2a;
            transform: scale(1.05);
        }

        .btn-secondary {
            background-color: #66d9ef;
            color: #1a202c;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        .btn-secondary:hover {
            background-color: #55c6db;
            transform: scale(1.05);
        }

        .input-field {
            background-color: #2d3748;
            color: #cbd5e0;
            border: none;
            box-shadow: inset 2px 2px 5px #121820, inset -2px -2px 5px #22283a;
            transition: box-shadow 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            box-shadow: inset 2px 2px 5px #121820, inset -2px -2px 5px #22283a, 0 0 0 2px #66d9ef;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .blog-editor-container {
            width: 95%;
            height: 95%;
            max-width: 1400px;
            background-color: #1a202c;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
        }
        
        .blog-editor-content {
            flex-grow: 1;
            display: grid;
            gap: 2rem;
            overflow-y: auto;
            min-height: 0;
        }

        /* --- STYLES FOR THE LIVE PREVIEW PANE --- */
        #previewContent {
            background-color: #2d3748;
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-y: auto;
            border: 2px solid #2d3748;
            flex-grow: 1;
        }

        #previewContent h1,
        #previewContent h2,
        #previewContent h3 {
            font-weight: bold;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
        }

        #previewContent h1 {
            font-size: 2.25rem;
            color: #a6e22e;
        }

        #previewContent h2 {
            font-size: 1.75rem;
            color: #a6e22e;
        }

        #previewContent h3 {
            font-size: 1.5rem;
            color: #66d9ef;
        }

        #previewContent p {
            margin-bottom: 1rem;
        }

        #previewContent ul,
        #previewContent ol {
            list-style-position: inside;
            padding-left: 1rem;
            margin-bottom: 1rem;
        }

        #previewContent ul {
            list-style-type: disc;
        }

        #previewContent a {
            color: #66d9ef;
            text-decoration: underline;
        }

        #previewContent strong {
            color: #a6e22e;
        }

        #previewContent blockquote {
            border-left: 4px solid #66d9ef;
            padding: 1rem 1.5rem;
            margin: 2rem 0;
            background-color: #2d3748;
            border-radius: 0 0.5rem 0.5rem 0;
            font-style: italic;
        }

        #previewContent pre {
            background-color: #1a202c;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
            border: 1px solid #4a5568;
        }

        #previewContent code {
            font-family: monospace;
        }
    </style>
</head>

<body class="antialiased min-h-screen">

    <!-- Navbar -->
    <nav class="fixed top-0 w-full bg-opacity-80 backdrop-filter backdrop-blur-lg z-50 shadow-lg transition-all duration-300"
        style="background-color: #1a202c;">
        <div class="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="text-xl font-bold gradient-text">Roshni Portfolio</a>
            <div class="space-x-4 flex items-center">
                <p id="userIdDisplay" class="text-sm text-gray-500 font-mono italic truncate max-w-[150px] sm:max-w-none">
                    Not authenticated</p>
                <button id="addBlogNavBtn"
                    class="btn-primary px-4 py-2 rounded-full font-semibold transition-all duration-300 transform hover:scale-105 hidden">Add
                    Blog</button>
                <button id="loginBtn"
                    class="btn-primary px-4 py-2 rounded-full font-semibold transition-all duration-300 transform hover:scale-105">Login</button>
                <button id="logoutBtn"
                    class="bg-red-500 px-4 py-2 rounded-full font-semibold hover:bg-red-600 hidden transition-all duration-300 transform hover:scale-105">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="pt-28 pb-12 text-center max-w-4xl mx-auto px-4">
        <h1 class="text-5xl font-extrabold tracking-tight mb-4 gradient-text">Insights & Articles</h1>
        <p class="text-lg text-gray-400 max-w-2xl mx-auto leading-relaxed">
            Dive into my thoughts on the latest tech trends, from AI to full-stack development.
            This is where I share my journey and discoveries.
        </p>
    </header>

    <!-- Insights Cards -->
    <main id="cardsContainer" class="max-w-4xl mx-auto px-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
        <p id="loadingMessage" class="col-span-full text-center text-lg text-gray-500">Loading blog posts...</p>
    </main>

    <footer class="py-6 text-center text-gray-500 border-t border-gray-700 mt-12">
        <p class="text-sm">© 2025 Roshni Portfolio. All Rights Reserved.</p>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center hidden z-50">
        <div class="neumorphic-card p-8 rounded-2xl shadow-lg w-96">
            <h2 class="text-2xl font-bold text-center mb-4">Admin Login</h2>
            <input id="email" type="email" placeholder="Email" class="input-field w-full p-3 mb-4 rounded-lg">
            <div class="relative mb-6">
                <input id="password" type="password" placeholder="Password" class="input-field w-full p-3 rounded-lg pr-12">
                <button id="togglePassword" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-200 focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path id="eyeOpen" d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                        <path id="eyeClosed" class="hidden" d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                        <path id="slash" class="hidden" fill-rule="evenodd" d="M10 3a7 7 0 00-6.236 4.316l-1.373 1.374a.75.75 0 001.06 1.06l1.374-1.373A7.001 7.001 0 0010 3zm-6.236 7.684L1.391 12.06a.75.75 0 001.06 1.06l2.373-2.373A7.001 7.001 0 0010 17a.75.75 0 000-1.5 5.5 5.5 0 01-4.872-3.136l1.58-1.58a.75.75 0 00-1.06-1.06z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
            <button id="submitLogin"
                class="btn-primary w-full p-3 rounded-full font-bold transition-all duration-300 transform hover:scale-105">Login</button>
        </div>
    </div>


    <!-- Add/Edit Blog Modal (Full-screen editor) -->
    <div id="addBlogModal" class="modal-overlay hidden">
        <div class="blog-editor-container neumorphic-card">
            <h2 id="modalTitle" class="text-3xl font-bold mb-4 gradient-text">Create a New Blog Post</h2>
            <input type="hidden" id="blogKey">
            <!-- The main scrolling content area -->
            <div class="blog-editor-content grid grid-cols-1 md:grid-cols-3">
                <!-- Input/Editor Column -->
                <div class="flex flex-col h-full">
                    <input id="blogTitle" type="text" placeholder="Blog Title"
                        class="input-field w-full p-3 rounded-lg text-2xl font-semibold">
                    <input id="blogAuthor" type="text" placeholder="Author Name"
                        class="input-field w-full p-3 rounded-lg text-lg">
                    <input id="blogImage" type="text" placeholder="Image URL (optional)"
                        class="input-field w-full p-3 rounded-lg text-lg">
                    <!-- Markdown Editor -->
                    <textarea id="blogContent" placeholder="Start writing your blog content here..."
                        class="input-field w-full p-3 rounded-lg text-base flex-1 min-h-[300px]"></textarea>
                </div>
                <!-- Live Preview Column -->
                <div class="flex flex-col h-full">
                    <h3 class="text-xl font-bold mb-4 gradient-text">Live Preview</h3>
                    <!-- This div will display the formatted markdown output -->
                    <div id="previewContent" class="input-field"></div>
                </div>
                <!-- Markdown Quick Guide Column -->
                <div class="flex flex-col h-full">
                    <h3 class="text-xl font-bold mb-4 gradient-text">Markdown Quick Guide</h3>
                    <div class="input-field overflow-y-auto">
                        <ul class="list-disc space-y-2 text-sm text-gray-400">
                            <li><strong>Headings:</strong> Use `#` to `###` for different sizes.</li>
                            <li class="pl-4">`# My Title`</li>
                            <li class="pl-4">`## Subheading`</li>
                            <li><strong>Bold:</strong> Use `**` before and after text.</li>
                            <li class="pl-4">`**bold text**`</li>
                            <li><strong>Italic:</strong> Use `*` or `_` before and after text.</li>
                            <li class="pl-4">`*italic text*`</li>
                            <li><strong>Blockquote:</strong> Use `>` to quote text.</li>
                            <li class="pl-4">`> This is a quote`</li>
                            <li><strong>Lists:</strong> Use `-` or `*` for bullet points.</li>
                            <li class="pl-4">`- Item 1`</li>
                            <li class="pl-4">`- Item 2`</li>
                            <li><strong>Numbered Lists:</strong> Use `1.`, `2.`, etc.</li>
                            <li class="pl-4">`1. First item`</li>
                            <li class="pl-4">`2. Second item`</li>
                            <li><strong>Links:</strong> Use `[text](url)` to create a link.</li>
                            <li class="pl-4">`[My Site](https://example.com)`</li>
                            <li><strong>Code:</strong> Use ``` ` ``` for inline code or ``` ``` for blocks.</li>
                            <li class="pl-4">`const myVar = 1;`</li>
                            <li class="pl-4">`const myVar = 'Hello, World!';
console.log(myVar);`</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="flex justify-end space-x-4 mt-8">
                <button id="deleteBlogBtn"
                    class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-full font-bold transition-colors hidden">Delete
                    Blog</button>
                <button id="cancelAddBlogBtn"
                    class="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-full font-bold transition-colors">Cancel</button>
                <button id="addBlogBtn"
                    class="btn-primary px-6 py-3 rounded-full font-bold transition-colors">Save Blog</button>
            </div>
        </div>
    </div>

    <!-- Custom alert/message box -->
    <div id="messageBox"
        class="fixed bottom-8 right-8 bg-gray-800 text-white p-4 rounded-lg shadow-lg hidden transition-opacity duration-300">
        <p id="messageText"></p>
    </div>

    <script type="module">
        const { initializeApp, getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, signInAnonymously, getFirestore, doc, getDoc, addDoc, setDoc, deleteDoc, onSnapshot, collection, query, setLogLevel } = window.firebase;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        // Hardcoded Firebase config to fix the initialization error
        const firebaseConfig = {
            apiKey: "AIzaSyBKXdLLXhAwgm8JE4eGmGEnDq6YGs2x-oo",
            authDomain: "roshni-portfolio-01.firebaseapp.com",
            projectId: "roshni-portfolio-01",
            storageBucket: "roshni-portfolio-01.firebasestorage.app",
            messagingSenderId: "129693722093",
            appId: "1:129693722093:web:2c0075a465d48451f3f3e4",
            measurementId: "G-QGCW2GCNPM"
        };
        
        let app, db, auth, userId = null;
        let isAuthReady = false;
        let currentUser = null; // Store the Firebase user object

        // Elements
        const loginBtn = document.getElementById("loginBtn");
        const logoutBtn = document.getElementById("logoutBtn");
        const addBlogNavBtn = document.getElementById("addBlogNavBtn");
        const loginModal = document.getElementById("loginModal");
        const submitLoginBtn = document.getElementById("submitLogin");
        const emailInput = document.getElementById("email");
        const passwordInput = document.getElementById("password");
        const togglePasswordBtn = document.getElementById("togglePassword");
        const addBlogModal = document.getElementById("addBlogModal");
        const addBlogBtn = document.getElementById("addBlogBtn");
        const cancelAddBlogBtn = document.getElementById("cancelAddBlogBtn");
        const deleteBlogBtn = document.getElementById("deleteBlogBtn");
        const cardsContainer = document.getElementById("cardsContainer");
        const messageBox = document.getElementById("messageBox");
        const messageText = document.getElementById("messageText");
        const modalTitle = document.getElementById("modalTitle");
        const blogKeyInput = document.getElementById("blogKey");
        const userIdDisplay = document.getElementById("userIdDisplay");
        const loadingMessage = document.getElementById("loadingMessage");
        const eyeOpenIcon = document.getElementById("eyeOpen");
        const eyeClosedIcon = document.getElementById("eyeClosed");
        const slashIcon = document.getElementById("slash");

        // Blog content inputs and preview
        const blogTitleInput = document.getElementById("blogTitle");
        const blogAuthorInput = document.getElementById("blogAuthor");
        const blogImageInput = document.getElementById("blogImage");
        const blogContentInput = document.getElementById("blogContent");
        const previewContent = document.getElementById("previewContent");

        // Custom message box function
        function showMessage(message) {
            messageText.textContent = message;
            messageBox.classList.remove("hidden");
            messageBox.style.opacity = 1;
            setTimeout(() => {
                messageBox.style.opacity = 0;
                setTimeout(() => messageBox.classList.add("hidden"), 300);
            }, 3000);
        }

        // Renders the blog cards from the fetched data
        function renderBlogs(blogs) {
            cardsContainer.innerHTML = "";
            loadingMessage.classList.add("hidden");
            if (blogs.length === 0) {
                cardsContainer.innerHTML = `<p class="col-span-full text-center text-lg text-gray-500">No blog posts yet. Be the first to add one!</p>`;
            } else {
                blogs.forEach(blog => {
                    const card = document.createElement("div");
                    card.className = "neumorphic-card p-6 rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300";
                    
                    // Create a short description with a maximum of 200 characters
                    let shortDesc = blog.content ? blog.content.substring(0, 200) + '...' : '';
                    
                    // Convert markdown in the short description to HTML for rendering
                    const renderedDesc = marked.parse(shortDesc);

                    card.innerHTML = `
                        <img src="${blog.image}" onerror="this.onerror=null; this.src='https://placehold.co/800x600/1a202c/FFFFFF?text=Placeholder'" alt="${blog.title}" class="rounded-xl mb-4 w-full h-48 object-cover transition-transform duration-300 transform hover:scale-105">
                        <h2 class="text-xl font-bold my-3 gradient-text">${blog.title}</h2>
                        <div class="text-gray-400 mb-4 line-clamp-3">${renderedDesc}</div>
                        <a href="/insight.html?key=${blog.key}" class="text-blue-400 hover:text-blue-300 font-medium read-more-btn">Read More →</a>
                        <button class="edit-btn text-blue-400 hover:text-blue-300 font-medium ml-4 hidden" data-key="${blog.key}">Edit</button>
                    `;
                    cardsContainer.appendChild(card);
                });
            }
            updateUIForLogin();
        }

        // Hides/shows UI elements based on login status
        function updateUIForLogin() {
            // Check if user is authenticated and is NOT an anonymous user
            if (isAuthReady && currentUser && !currentUser.isAnonymous) {
                document.querySelectorAll(".edit-btn").forEach(btn => btn.classList.remove("hidden"));
                addBlogNavBtn.classList.remove("hidden");
                logoutBtn.classList.remove("hidden");
                loginBtn.classList.add("hidden");
                userIdDisplay.textContent = `UserID: ${userId}`;
            } else {
                document.querySelectorAll(".edit-btn").forEach(btn => btn.classList.add("hidden"));
                addBlogNavBtn.classList.add("hidden");
                logoutBtn.classList.add("hidden");
                loginBtn.classList.remove("hidden");
                userIdDisplay.textContent = 'Not authenticated';
            }
        }

        // Firebase Initialization and Authentication
        async function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // This listener ensures we're authenticated before fetching data
                onAuthStateChanged(auth, (user) => {
                    currentUser = user; // Store the current user object
                    userId = user ? user.uid : null;
                    isAuthReady = true;
                    // Start fetching data only after authentication state is confirmed
                    setupRealtimeListener();
                    updateUIForLogin();
                });

                // Sign in anonymously on page load for non-admin users to view content
                if (!auth.currentUser) {
                    await signInAnonymously(auth);
                }

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                if (error.code === 'auth/admin-restricted-operation') {
                    console.error("Please enable 'Anonymous' sign-in in your Firebase Authentication settings to fix this error.");
                    showMessage("Authentication failed. Please check Firebase settings.");
                } else {
                    showMessage("Failed to connect to the database.");
                }
            }
        }

        // Set up real-time listener for blogs
        function setupRealtimeListener() {
            if (!db) return;

            // Use the public collection path for blogs
            const blogsRef = collection(db, `artifacts/${appId}/public/data/blogs`);
            onSnapshot(blogsRef, (snapshot) => {
                const blogs = [];
                snapshot.forEach(doc => {
                    blogs.push({ key: doc.id, ...doc.data() });
                });
                renderBlogs(blogs);
            }, (error) => {
                console.error("Error fetching documents:", error);
                if (error.code === 'permission-denied') {
                    console.error("The 'permission-denied' error means your Firestore security rules are preventing this app from reading the blog data. Please update your rules to allow public reads. Example: 'allow read: if true;'");
                    showMessage("Permissions error: You may need to update your Firestore security rules to allow public reads.");
                } else {
                    showMessage("Failed to fetch blogs from database.");
                }
            });
        }

        // Opens the Add/Edit blog modal with optional pre-filled content
        async function openAddBlogModal(isNew = true, blogData = {}) {
            if (!isAuthReady || (currentUser && currentUser.isAnonymous)) {
                showMessage("You must be logged in to add or edit a blog.");
                return;
            }

            if (isNew) {
                modalTitle.textContent = "Create a New Blog Post";
                addBlogBtn.textContent = "Save Blog";
                blogKeyInput.value = "";
                addBlogBtn.classList.remove("hidden");
                deleteBlogBtn.classList.add("hidden");
                blogTitleInput.value = "";
                blogAuthorInput.value = 'Roshni Mishra';
                blogImageInput.value = "";
                blogContentInput.value = `# My New Blog Post

## A Subheading

Start writing your **blog content** here. You can use markdown to format your text.

- Use a bulleted list.
- Like this.

1. Or a numbered list.
2. Like this.

You can also use \`code blocks\` for code snippets.

\`\`\`javascript
// Example Code
const myVar = 'Hello, World!';
console.log(myVar);
\`\`\`
`;
            } else {
                modalTitle.textContent = "Edit Blog Post";
                addBlogBtn.textContent = "Update Blog";
                blogKeyInput.value = blogData.key;
                blogTitleInput.value = blogData.title;
                blogAuthorInput.value = blogData.author || "Roshni Mishra";
                blogImageInput.value = blogData.image || "";
                blogContentInput.value = blogData.content;
                addBlogBtn.classList.remove("hidden");
                deleteBlogBtn.classList.remove("hidden");
            }
            updatePreview();
            addBlogModal.classList.remove("hidden");
        }

        // Updates the live preview pane with formatted markdown
        function updatePreview() {
            const markdownText = blogContentInput.value;
            previewContent.innerHTML = marked.parse(markdownText);
        }

        // Event Listeners
        loginBtn.addEventListener("click", () => loginModal.classList.remove("hidden"));
        addBlogNavBtn.addEventListener("click", () => openAddBlogModal(true));
        cancelAddBlogBtn.addEventListener("click", () => addBlogModal.classList.add("hidden"));

        // Toggle password visibility
        togglePasswordBtn.addEventListener("click", () => {
            const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
            passwordInput.setAttribute("type", type);
            eyeOpenIcon.classList.toggle("hidden");
            eyeClosedIcon.classList.toggle("hidden");
            slashIcon.classList.toggle("hidden");
        });

        submitLoginBtn.addEventListener("click", async () => {
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();

            if (!email || !password) {
                showMessage("Please enter both email and password.");
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
                loginModal.classList.add("hidden");
                showMessage("Login successful!");
            } catch (error) {
                console.error("Login failed:", error.message);
                if (error.code === 'auth/operation-not-allowed') {
                    showMessage("Login failed. Email/Password sign-in is not enabled. Please check your Firebase settings.");
                } else {
                    showMessage("Login failed. Check your email and password.");
                }
            }
        });

        // Save/Update blog logic
        addBlogBtn.addEventListener("click", async () => {
            const title = blogTitleInput.value.trim();
            const author = blogAuthorInput.value.trim() || "Roshni Mishra";
            const image = blogImageInput.value.trim();
            const content = blogContentInput.value.trim();
            const key = blogKeyInput.value.trim();

            if (title && content && userId && !currentUser.isAnonymous) {
                const desc = content.substring(0, 200).replace(/\n/g, ' ') + '...';
                const blogImage = image || "https://placehold.co/800x600/1a202c/FFFFFF?text=" + encodeURIComponent(title.split(' ')[0]);
                const blogData = {
                    title,
                    author,
                    desc,
                    content,
                    image: blogImage,
                    createdAt: new Date().toISOString()
                };

                try {
                    // Use the public collection path
                    const blogsRef = collection(db, `artifacts/${appId}/public/data/blogs`);
                    if (key) {
                        await setDoc(doc(blogsRef, key), blogData);
                        showMessage("Blog updated successfully!");
                    } else {
                        await addDoc(blogsRef, blogData);
                        showMessage("Blog added successfully!");
                    }
                    addBlogModal.classList.add("hidden");
                } catch (e) {
                console.error("Error saving blog:", e);
                showMessage("Failed to save blog post.");
                }
            } else {
                showMessage("Please fill out all required fields and ensure you are authenticated.");
            }
        });

        // Delete blog logic
        deleteBlogBtn.addEventListener("click", async () => {
            const keyToDelete = blogKeyInput.value.trim();
            if (keyToDelete && userId && !currentUser.isAnonymous) {
                try {
                    // Use the public collection path
                    const blogDocRef = doc(db, `artifacts/${appId}/public/data/blogs`, keyToDelete);
                    await deleteDoc(blogDocRef);
                    showMessage("Blog deleted successfully!");
                    addBlogModal.classList.add("hidden");
                } catch (e) {
                    console.error("Error deleting blog:", e);
                    showMessage("Failed to delete blog post.");
                }
            }
        });

        // Edit button click listener
        document.addEventListener("click", async (e) => {
            if (e.target.classList.contains("edit-btn") && currentUser && !currentUser.isAnonymous) {
                const blogKey = e.target.getAttribute("data-key");
                try {
                    // Use the public collection path
                    const blogDocRef = doc(db, `artifacts/${appId}/public/data/blogs`, blogKey);
                    const docSnap = await getDoc(blogDocRef);
                    if (docSnap.exists()) {
                        openAddBlogModal(false, { key: docSnap.id, ...docSnap.data() });
                    }
                } catch (e) {
                    console.error("Error fetching blog for edit:", e);
                    showMessage("Failed to load blog for editing.");
                }
            }
        });

        // Logout listener
        logoutBtn.addEventListener("click", async () => {
            try {
                await signOut(auth);
                showMessage("Logged out successfully!");
            } catch (e) {
                console.error("Error during logout:", e);
                showMessage("Logout failed.");
            }
        });

        // Event listener for live preview
        blogContentInput.addEventListener("input", updatePreview);

        // Start Firebase initialization
        initializeFirebase();
    </script>
</body>

</html>
